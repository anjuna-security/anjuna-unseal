<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    
    <title>Getting started &#8212; Anjuna Vault Unseal 0.17.0050 documentation</title>

    <link rel="stylesheet" href="_static/material-icons.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/notosanscjkjp.css" />
    <link rel="stylesheet" type="text/css" href="_static/roboto.css" />
    <link rel="stylesheet" type="text/css" href="_static/material-design-lite-1.3.0/material.teal-red.min.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx_materialdesign_theme.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/sphinx_materialdesign_theme.js"></script>
    <link rel="shortcut icon" href="_static/unseal_logo.png"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Anjuna Tools Reference" href="tool-reference.html" />
    <link rel="prev" title="Installation" href="installing.html" /> 
  </head>
<body>
    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header mdl-layout--fixed-drawer"><header class="mdl-layout__header mdl-layout__header--waterfall ">
    <div class="mdl-layout__header-row">
        
        <nav class="mdl-navigation breadcrumb">
            <a class="mdl-navigation__link is-active">Getting started</a>
        </nav>
        <div class="mdl-layout-spacer"></div>
        <nav class="mdl-navigation">
        
<form class="form-inline pull-sm-right" action="search.html" method="get">
      <div class="mdl-textfield mdl-js-textfield mdl-textfield--expandable mdl-textfield--floating-label mdl-textfield--align-right">
        <label id="quick-search-icon" class="mdl-button mdl-js-button mdl-button--icon"  for="waterfall-exp">
            <i class="material-icons">search</i>
        </label>
        <div class="mdl-textfield__expandable-holder">
          <input class="mdl-textfield__input" type="text" name="q"  id="waterfall-exp" placeholder="Search" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </div>
      </div>
      <div class="mdl-tooltip" data-mdl-for="quick-search-icon">
      Quick search
      </div>
</form>
        
        </nav>
    </div>
    <div class="mdl-layout__header-row header-links">
      <div class="mdl-layout-spacer"></div>
      <nav class="mdl-navigation">
          
              <a  class="mdl-navigation__link" href="https://www.anjuna.io">
                  
				     
					  <i class="material-icons navigation-link-icon">home</i>
					
				  
                  Anjuna
              </a>
          
              <a  class="mdl-navigation__link" href="mailto:support@anjuna.io">
                  
				     
					  <i class="material-icons navigation-link-icon">email</i>
					
				  
                  Contact us
              </a>
          
              <a  class="mdl-navigation__link" href="https://join.slack.com/t/anjunacommunity/shared_invite/enQtNTcxNzkxMjI1ODMxLWRiYjhmYjM0YzdkYWUyY2UyOGViZjQ3ZWMyYjNlZmI2ZmI2MWY5ZGRhYmQ2MmVjNTM5MjY3MTE5YWM2NjkyYzM">
                  
				    
					  <img height="20px" src="_static/anjuna/slack.png"/>
				    
				  
                  Anjuna Community Slack
              </a>
      </nav>
    </div>
</header><header class="mdl-layout__drawer">
    
          <!-- Title -->
      <span class="mdl-layout-title">
          <a class="title" href="index.html">
              <img class="logo" src="_static/unseal_logo.svg" alt="Anjuna Vault Unseal"/>
          </a>
      </span>
    
<div class="globaltoc">
  <span class="mdl-layout-title toc">Table Of Contents</span>
  
  
      
      <nav class="mdl-navigation">
          <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="sgx-servers.html">Getting access to Intel® SGX</a></li>
<li class="toctree-l1"><a class="reference internal" href="installing.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="tool-reference.html">Anjuna Tools Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="reference/installer-reference.html">Anjuna Vault-Unseal tool Installer</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/sgx-unseal-config.html">Anjuna Vault Unseal Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/sgx-unseal-run.html">Anjuna Vault Unseal</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/vault-quick-setup.html">Tutorial: Setting up a Vault test instance</a></li>
</ul>
</li>
</ul>

      </nav>
  
  </div>

</header>
        <main class="mdl-layout__content" tabIndex="0">
<header class="mdl-layout__drawer">
    
          <!-- Title -->
      <span class="mdl-layout-title">
          <a class="title" href="index.html">
              <img class="logo" src="_static/unseal_logo.svg" alt="Anjuna Vault Unseal"/>
          </a>
      </span>
    
<div class="globaltoc">
  <span class="mdl-layout-title toc">Table Of Contents</span>
  
  
      
      <nav class="mdl-navigation">
          <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="sgx-servers.html">Getting access to Intel® SGX</a></li>
<li class="toctree-l1"><a class="reference internal" href="installing.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="tool-reference.html">Anjuna Tools Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="reference/installer-reference.html">Anjuna Vault-Unseal tool Installer</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/sgx-unseal-config.html">Anjuna Vault Unseal Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/sgx-unseal-run.html">Anjuna Vault Unseal</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/vault-quick-setup.html">Tutorial: Setting up a Vault test instance</a></li>
</ul>
</li>
</ul>

      </nav>
  
  </div>

</header>

    <div class="document">
        <div class="page-content">
        
  <div class="section" id="getting-started">
<span id="anchor-getting-started"></span><h1>Getting started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h1>
<p>In this section, we will go through the steps to:</p>
<ul class="simple">
<li>Create a Vault Unseal configuration file</li>
<li>Encrypt the configuration file using the SGX Sealing capabilities</li>
<li>Run the Vault Unseal utility using the Anjuna SGX Runtime to unseal
a running Vault instance.</li>
</ul>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Reminder: it is important to run the following command to make it possible
to run the Anjuna tools (replace or define <code class="docutils literal notranslate"><span class="pre">ANJUNA_HOME</span></code> with the correct value):</p>
<div class="last highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">source</span> <span class="si">${</span><span class="nv">ANJUNA_HOME</span><span class="si">}</span>/env.sh
</pre></div>
</div>
</div>
<div class="section" id="anjuna-vault-unseal-tool-installation">
<h3>Anjuna Vault-Unseal tool installation<a class="headerlink" href="#anjuna-vault-unseal-tool-installation" title="Permalink to this headline">¶</a></h3>
<p>If Anjuna Vault-Unseal tool was properly installed, and the environment set using <code class="docutils literal notranslate"><span class="pre">env.sh</span></code>,
running <code class="docutils literal notranslate"><span class="pre">anjuna-encrypt</span></code> should work and produce the following output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ anjuna-encrypt
Usage: anjuna-encrypt <span class="o">[</span>OPTIONS<span class="o">]</span>... FILE
</pre></div>
</div>
<p>If the command fails with the following message, the Anjuna Vault-Unseal tool environment
is not setup correctly.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ anjuna-encrypt
anjuna-encrypt: <span class="nb">command</span> not found
</pre></div>
</div>
<p>See the note above to correct the issue.</p>
</div>
<div class="section" id="vault-instance">
<h3>Vault instance<a class="headerlink" href="#vault-instance" title="Permalink to this headline">¶</a></h3>
<p>We assume Vault has been properly setup:</p>
<ul class="simple">
<li>Vault is running</li>
<li>Vault is configured with a TLS listener</li>
<li>Vault is sealed</li>
<li>The Vault CA Certificate is available</li>
<li>The Vault <strong>unseal keys</strong> are available</li>
</ul>
<p>If such an instance is not available, the next section will describe
a few simple steps to quickly setup a test instance suitable for this tutorial.</p>
</div>
</div>
<div class="section" id="setup-a-working-directory">
<h2>Setup a working directory<a class="headerlink" href="#setup-a-working-directory" title="Permalink to this headline">¶</a></h2>
<p>Create a working directory where the files for unsealing a specific instance
of Vault will be located.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ mkdir vault-unseal-tutorial
$ <span class="nb">cd</span> vault-unseal-tutorial
</pre></div>
</div>
</div>
<div class="section" id="create-a-test-vault-instance">
<h2>Create a test Vault instance<a class="headerlink" href="#create-a-test-vault-instance" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The instructions in this section are optional. If you already have a running
Vault instance, just proceed to the <a class="reference internal" href="#anchor-create-unseal-config-file"><span class="std std-ref">Create the Vault Unseal Configuration File</span></a>
section.</p>
<p class="last">If you do not have a running Vault instance, or if you do not want to use your
existing Vault instance to learn about the Vault Unseal utility,
follow the steps in this section.</p>
</div>
<p>To create a test instance for the purpose of going through the steps of this
tutorial, you can just enter the following commands to quickly create
a test configuration of a Vault server running with a TLS certificate:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ anjuna-tutorial-quick-vault-setup --port <span class="m">9980</span>
$ anjuna-tutorial-quick-vault-setup --start
</pre></div>
</div>
<p>These commands will create a Vault configuration and start it after displaying
the configuration parameters (notice the different port used by this Vault
instance to avoid conflicting with any running Vault instance on this host).</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ anjuna-tutorial-quick-vault-setup --port <span class="m">9980</span>
Launching Anjuna Tutorial Vault instance...
Initializing Vault...
Unsealing Vault...
Using unseal key <span class="c1">#1...</span>
Using unseal key <span class="c1">#2...</span>
Using unseal key <span class="c1">#3...</span>
Vault server unsealed
Connection to Vault...
Generating <span class="nb">test</span> wildcard certificate...
TLS certificates generated
Success: A <span class="nb">test</span> Vault configuration was created!
Vault Address          : https://vault.anjuna.test:9980
Vault Server CA-CERT   : /home/anjuna/vault-unseal-tutorial/config/ca.crt
Vault Root Token       : <span class="c1"># root_token: 1gDYjJsGKW65L7SXPw55WIOD</span>
Vault Unseal keys      :
- jZYf9QD5KGXyV4uPFsWBDMTpqCrj9kOreq2RaAlBRI24
- 9riaEZETGJg7FP8rI5PkPxOvowNDZc4N1UOXiwkIA7HR
- yQ6niGrXCweJRB9/jId+sQRDQhYpgY9GYLm2sQk7beAJ


To start Vault, run the following command:
  anjuna-tutorial-quick-vault-setup --start


$ anjuna-tutorial-quick-vault-setup --start
Starting Vault...
Vault Address          : https://vault.anjuna.test:9980
Vault Server CA-CERT   : /home/anjuna/vault-unseal-tutorial/config/ca.crt
Vault Root Token       : <span class="c1"># root_token: 1gDYjJsGKW65L7SXPw55WIOD</span>
Vault Unseal keys      :
- jZYf9QD5KGXyV4uPFsWBDMTpqCrj9kOreq2RaAlBRI24
- 9riaEZETGJg7FP8rI5PkPxOvowNDZc4N1UOXiwkIA7HR
- yQ6niGrXCweJRB9/jId+sQRDQhYpgY9GYLm2sQk7beAJ
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The first execution of <code class="docutils literal notranslate"><span class="pre">anjuna-tutorial-quick-vault-setup</span> <span class="pre">--start</span></code> will trigger
the following message:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ anjuna-tutorial-quick-vault-setup --start
Warning:
To use the Vault TLS certificate, the following entry should be added to /etc/hosts:
<span class="m">127</span>.0.0.1 vault.anjuna.test

Run the following <span class="nb">command</span> to add this entry to /etc/hosts
    $ <span class="nb">echo</span> <span class="s1">&#39;127.0.0.1 vault.anjuna.test&#39;</span> <span class="p">|</span> sudo tee -a /etc/hosts
</pre></div>
</div>
<p>This occurs only because the test TLS certificate generated for the Vault
instance assumes the value <code class="docutils literal notranslate"><span class="pre">vault.anjuna.test</span></code> for the hostname.
Just run the following command (as indicated in the message)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s1">&#39;127.0.0.1 vault.anjuna.test&#39;</span> <span class="p">|</span> sudo tee -a /etc/hosts
</pre></div>
</div>
<p>and re-run the <code class="docutils literal notranslate"><span class="pre">anjuna-tutorial-quick-vault-setup</span> <span class="pre">--start</span></code> command again:</p>
<div class="last highlight-bash notranslate"><div class="highlight"><pre><span></span>$ anjuna-tutorial-quick-vault-setup --start
</pre></div>
</div>
</div>
<p>We now have a test Vault instance with the required information to create the
Vault Unseal Configuration File:</p>
<ul class="simple">
<li>The server address</li>
<li>The CA Certificate</li>
<li>The unseal keys</li>
</ul>
</div>
<div class="section" id="create-the-vault-unseal-configuration-file">
<span id="anchor-create-unseal-config-file"></span><h2>Create the Vault Unseal Configuration File<a class="headerlink" href="#create-the-vault-unseal-configuration-file" title="Permalink to this headline">¶</a></h2>
<p>Run</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ anjuna-create-unseal-config
</pre></div>
</div>
<p>It will prompt you for the information needed to create a configuration file:</p>
<ul class="simple">
<li>The Vault server URL</li>
<li>The path to the Vault server certificate (or the CA certificate associated
with the Vault server certificate)</li>
<li>Vault unseal keys</li>
</ul>
<p>Here is an example of running the script:</p>
<div class="highlight-none notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ anjuna-create-unseal-config
Anjuna Vault Unseal Configuration
-----
[Vault URL]       : https://vault.anjuna.test:9980
[Vault CA-CERT]   : /home/anjuna/vault-unseal-tutorial/config/ca.crt
[Unseal Key #1]   : jZYf9QD5KGXyV4uPFsWBDMTpqCrj9kOreq2RaAlBRI24
[Unseal Key #2]   : 9riaEZETGJg7FP8rI5PkPxOvowNDZc4N1UOXiwkIA7HR
[Unseal Key #3]   : yQ6niGrXCweJRB9/jId+sQRDQhYpgY9GYLm2sQk7beAJ
[Unseal Key #4]   :
Using Vault endpoint: https://vault.anjuna.test:9980
Using Vault CA-CERT: /home/anjuna/vault-unseal-tutorial/config/ca.crt
Using Unseal Keys:
- jZYf9QD5KGXyV4uPFsWBDMTpqCrj9kOreq2RaAlBRI24
- 9riaEZETGJg7FP8rI5PkPxOvowNDZc4N1UOXiwkIA7HR
- yQ6niGrXCweJRB9/jId+sQRDQhYpgY9GYLm2sQk7beAJ
Generating unseal-config.yml in current directory
Encrypting unseal-config.yml
Sealed unseal-config.yml to unseal-config.yml.sealed
Deleting unseal-config.yml
Success: unseal-config.yml.sealed generated =&gt; the Vault unseal configuration was created and encrypted
</pre></div>
</td></tr></table></div>
<ul class="simple">
<li>Line 4: Enter the URL for the Vault server. This should be an HTTPS URL, and
it should include the port Vault is listening on. This is the same address
as what would be specified in the <code class="docutils literal notranslate"><span class="pre">--address=</span></code> command line parameter when
running the vault client or in the <code class="docutils literal notranslate"><span class="pre">VAULT_ADDR</span></code> environment variable
(see <a class="reference external" href="https://www.vaultproject.io/docs/commands/">Vault Commands (CLI)</a>
for more information on the Vault client tool).</li>
<li>Line 5: Enter the path of a PEM-encoded CA certificate.
It is used to verify the Vault server’s TLS certificate.</li>
<li>Line 6-9: Enter each one of unseal keys for this Vault instance (one per line).
Enter an empty string to indicate that all the keys have been provided.</li>
<li>Line 11-18: The script checks for the Vault URL and the Vault CA certificate.</li>
</ul>
<p>If the provided values are correct, the configuration will be created and
encrypted.</p>
</div>
<div class="section" id="unseal-vault">
<h2>Unseal Vault<a class="headerlink" href="#unseal-vault" title="Permalink to this headline">¶</a></h2>
<p>Using the previous created Vault Unseal configuration, we can now securely
unseal Vault:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ anjuna-vault-unseal
</pre></div>
</div>
<p>which produces the following output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Found Vault Unseal configuration =&gt; unsealing now...
2019/03/05 11:01:23 - Unsealing Vault https://vault.anjuna.test:9980 using token 1/3
2019/03/05 11:01:23 - Unsealing Vault https://vault.anjuna.test:9980 using token 2/3
2019/03/05 11:01:23 Vault is now unsealed
</pre></div>
</div>
</div>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Congratulations! You have created a Vault Unseal encrypted configuration
that can securely unseal your Vault instance!</p>
</div>
</div>


        </div>
        <div class="side-doc-outline">
            <div class="side-doc-outline--content"> 
<div class="localtoc">
    <p class="caption">
      <span class="caption-text">Table Of Contents</span>
    </p>
    <ul>
<li><a class="reference internal" href="#">Getting started</a><ul>
<li><a class="reference internal" href="#prerequisites">Prerequisites</a><ul>
<li><a class="reference internal" href="#anjuna-vault-unseal-tool-installation">Anjuna Vault-Unseal tool installation</a></li>
<li><a class="reference internal" href="#vault-instance">Vault instance</a></li>
</ul>
</li>
<li><a class="reference internal" href="#setup-a-working-directory">Setup a working directory</a></li>
<li><a class="reference internal" href="#create-a-test-vault-instance">Create a test Vault instance</a></li>
<li><a class="reference internal" href="#create-the-vault-unseal-configuration-file">Create the Vault Unseal Configuration File</a></li>
<li><a class="reference internal" href="#unseal-vault">Unseal Vault</a></li>
<li><a class="reference internal" href="#summary">Summary</a></li>
</ul>
</li>
</ul>

</div>
            </div>
        </div>

      <div class="clearer"></div>
    </div><div class="pagenation">
     <a id="button-prev" href="installing.html" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--colored" role="botton" accesskey="P">
         <i class="pagenation-arrow-L material-icons">arrow_back</i>
         <div class="pagenation-text">
            <span class="pagenation-direction">Previous</span>
            <div>Installation</div>
         </div>
     </a>
     <a id="button-next" href="tool-reference.html" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--colored" role="botton" accesskey="N">
        <i class="pagenation-arrow-R material-icons">arrow_forward</i>
        <div class="pagenation-text">
            <span class="pagenation-direction">Next</span>
            <div>Anjuna Tools Reference</div>
        </div>
     </a>
  </div>

        <footer class="mdl-mini-footer">
    <div class="mdl-mini-footer__left-section">
      <div class="mdl-logo">Anjuna Vault Unseal</div>
      <!--div>
        
        <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="sgx-servers.html">Getting access to Intel® SGX</a></li>
<li class="toctree-l1"><a class="reference internal" href="installing.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="tool-reference.html">Anjuna Tools Reference</a></li>
</ul>

      </div-->
    </div>

    <div class="mdl-mini-footer__right-section">
        <div>&copy; Copyright 2019, Anjuna Security, Inc..</div>
	  <div> <a href="privacy.html">Privacy policy</a> </div>
    </div>
</footer>
        </main>
    </div>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-133911409-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-133911409-2');
</script>


<script type="text/javascript" src="https://secure.leadforensics.com/js/145499.js" ></script>
<noscript><img alt="" src="https://secure.leadforensics.com/145499.png" style="display:none;" /></noscript>


  </body>
</html>